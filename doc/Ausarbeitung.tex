\include{Einstellungen}
% Bindet die Literaturdaten ein!
\bibliography{Bibliographie}
\begin{document}

%Startstruktur
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{2}

\pagestyle{empty}
\input{Deckblatt}

\tableofcontents
\setcounter{page}{1}

\pagestyle{scrheadings}

\newpage

\section{Einleitung}

Aufgabe dieses Projekts war es eine Autovermietung mithilfe von jBPM und Drools zu erstellen. Die Geschäftsregeln sollen am Ende über eine Domain-Specific-Language (DSL) verwaltet werden. Zur Definition der Regeln wurden die dreizehn Aussagen aus der Aufgabenstellung analysiert und ausgewertet. 

Im Laufe dieser Projektdokumentation werden die einzelnen Arbeitsschritte strukturiert und detailliert beschrieben. Der Quellcode und die Projektdokumentation kann über ein öffentliches Git-Repository (\url{https://github.com/fabian-paus/car-rental}) auf GitHub.com eingesehen werden. 

Als Ergebnis haben wir eine grafische Benutzeroberfläche entworfen, über die eine Mietanfrage an die Prozess-Engine gesendet werden kann. Die Prozess-Engine verarbeitet die Anfrage und nutzt die Regel-Engine zur Ausführung von Geschäftsregeln.
Unter gewissen Bedingungen muss der Filialleiter einen Schritt genehmigen.
Am Ende wird die Anfrage entweder angenommen oder abgelehnt. Eine angenommene Anfrage enthält dann eine Fahrzeugklasse und einen Gesamtpreis. Diese Daten werden dann über die Oberfläche an den Benutzer ausgegeben. 

\section{Einarbeitung}

Um die Aufgabe besser zu strukturieren definieren wir zunächst einige Domänenbegriffe und 
beschreiben dann den Ablauf des Vermietungsprozesses mithilfe eines Flussdiagramms.

\subsection{Domänenbegriffe}

In diesem Abschnitt werden Begriffe, die für den Vermietungsprozess wichtig sind, definiert.
Diese Begriffe werden in Diagrammen, in Regeln und bei der Prozessdefinition verwendet.
Einige Begriffe werden nicht exakt definiert, da diese später in Regeln genauer
festgelegt werden.

\begin{description}
	\item[Kunde:] Ein Kunde möchte einen Wagen mieten. Für jeden Kunden sind folgende Eigenschaften bekannt:
		\begin{description}
			\item[Alter:] Wie alt ist der Kunde? Einheit: Jahre
			\item[Führerscheindauer:] Wie lange hat der Kunde seinen Führerschein? Einheit: Jahre
			\item[Sicherheitstraining:] Hat der Kunde ein Fahrsicherheitstraining absolviert?
			\item[Reklamation:] Hat der Kunde eine berechtigte Reklamation vorgebracht?
			\item[Neukunde:] Ist der Kunde zum ersten Mal bei der Autovermietung?
		\end{description}
	\item[Fahranfänger] Ein Kunde ist ein Fahranfänger, wenn er jünger als ein bestimmtes Alter ist oder
		seinen Führerschein noch nicht sehr lange besitzt. Die genaue Definition erfolgt anhand einer
		Geschäftsregel.	
	\item[Filialleiter:] Gewisse Entscheidung beim Vermietungsprozess bedürfen der Genehmigung durch
		den Filialleiter.
	\item[Klasse:] Ein zu mietender Wagen wird in vier Klassen eingeteilt:
		\begin{description}
			\item[Klein:] Kleinwagen
			\item[Kompakt:] Kompaktwagen
			\item[Mittel:] Mittelklassewagen
			\item[Ober] Oberklassewagen
		\end{description}
	\item[Anfrage:] Eine Anfrage für einen Mietwagen wird von einem Kunden gestellt. Sie enthält folgende Informationen:
		\begin{description}
			\item[Fahrer:] Welche Kunden fahren mit dem Auto? (Achtung: mehr als ein Fahrer möglich)
			\item[Startdatum:] Ab welchem Datum wird das Auto gemietet? Einheit: Datum
			\item[Dauer:] Für wie lange soll das Auto gemietet werden? Einheit: Tage
			\item[Klasse:] Welche Wagenklasse soll gemietet werden? Einheit: Klasse (siehe Definition oben)
			\item[Automatik:] Soll der Mietwagen eine Automatikschaltung haben?
		\end{description}
	\item[Tagespreis:] Der Tagespreis ist der Preis für eine Mietdauer von einem Tag. Einheit: Euro
	\item[Basispreis:] Der Basispreis ist die Summe der Tagespreise über die gesamte Dauer. Einheit: Euro
	\item[Rabatt:] Der Rabatt ist ein Nachlass, der auf Kundenbasis ermittelt wird. Einheit: Euro
	\item[Automatikgebühr:] Eine zusätzliche Gebühr, falls ein Automatikwagen gemietet wird. Einheit: Euro
	\item[Endpreis:] Der Endpreis wird aus dem Basispreis, dem Rabatt und der Automatikgebühr berechnet. Einheit: Euro
	\item[Zuschlag:] Ein prozentualer Zuschlag auf den Endpreis. Einheit: Prozent
	\item[Nachlass:] Ein prozentualer Nachlass auf den Endpreis. Einheit: Prozent
	\item[Gesamtpreis:] Nachdem Zuschlag und Nachlass auf den Endpreis berechnet wurden, ergibt sich der Gesamtpreis. Einheit: Euro
	
\end{description}

\subsection{Flussdiagramm}

Anhand des Flussdiagramms beschreiben wir den gesamten Vermietungsprozess. Dabei gehen wir auf
die einzelnen Aussagen aus der Aufgabenstellung ein.

\subsubsection{Gesamter Prozess}

Wir haben den gesamten Prozess in drei Teilprozesse unterteilt:
\begin{enumerate}
	\item Fahranfängerprüfung
	\item Verfügbarkeitsprüfung
	\item Preisberechnung
\end{enumerate}

Nach Aussage 3 wird zuerst geprüft, ob die Anfrage die maximale Dauer überschreitet.

\begin{figure}[tbh]
\centering
\includegraphics[width=1.0\linewidth]{Bilder/Preis_berechnen}
\caption{Preisfindung}
\label{fig:Preis_berechnen}
\end{figure}

\subsubsection{Fahranfängerprüfung}

In Aussage 10 wird definiert, wer als Fahranfänger eingestuft wird, und welcher Aufschlag in dem 
Fall zu zahlen ist. Aussage 11 bestimmt die Fahrzeugklassen, die nur mit Genehmigung vom Filialleiter
durch Fahranfängern gemietet werden dürfen.

\begin{figure}[H]
\centering
\includegraphics[width=0.8\linewidth]{Bilder/Fahranfaenger_pruefen}
\caption{Fahranfängerprüfung}
\label{fig:Fahranfänger_prüfen}
\end{figure}

\subsubsection{Verfügbarkeitsprüfung}

Aussagen: 12 (Kostenloses Upgrade nach Genehmigung), 13 (Downgrade aus Oberklasse)

In Aussage 12 wird beschrieben, was passieren soll, wenn kein Fahrzeug der angefragten Klasse
verfügbar ist. Dann wird nach Genehmigung durch den Filialleiter ein kostenloses Upgrade 
auf die nächsthöhere Klasse durchgeführt. 
Aussage 13 erläutert den Fall, wenn kein Oberklassewagen verfügbar ist. In dem Fall wird
ein Downgrade auf die Mittelklasse durchgeführt mit zusätzlichem Nachlass auf den Endpreis.

\begin{figure}[H]
\centering
\includegraphics[width=0.55\linewidth]{Bilder/Verfuegbarkeit_pruefen}
\caption{Verfügbarkeitsprüfung}
\label{fig:Verfuegbarkeit_pruefen}
\end{figure}

\subsubsection{Preisberechnung}

Die Preisberechnung besteht aus drei Schritten:
\begin{enumerate}
	\item Basispreisberechnung
	\item Rabattberechnung
	\item Automatikgebühr (nach Aussage 8)
\end{enumerate}

Der Endpreis setzt sich aus dem Basispreis abzüglich des Rabatts und zuzüglich 
der Automatikgebühr zusammen.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\linewidth]{Bilder/Endpreis_berechnen}
	\caption{Endpreis berechnen}
	\label{fig:Endpreis_berechnen}
\end{figure}

\newpage 
\paragraph{Basispreis}

Der Basispreis entspricht der Summe aller Tagespreise.

\begin{figure}[H]
	\centering
	\includegraphics[width=1.0\linewidth]{Bilder/Basispreis_berechnen}
	\caption{Basispreis berechnen}
	\label{fig:Basispreis_berechnen}
\end{figure}

\paragraph{Tagespreis}

Bei der Tagespreisberechnung werden die Aussagen 1, 2 und 3 berücksichtigt.

Aussage 1 bestimmt den Tagespreis in Abhängigkeit von der Fahrzeugklasse.
Der Tagespreis wird allerdings an Wochenenden und Feiertagen nach Aussage 2
reduziert. Außerdem ist jeder siebte Tag nach Aussage 3 kostenlos.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\linewidth]{Bilder/Tagespreis_berechnen}
	\caption{Tagespreis berechnen}
	\label{fig:Tagespreis_berechnen}
\end{figure}

\paragraph{Rabatt}

Bei der Rabattberechnung werden laut Aussagen 4, 5 und 6 die Eigenschaften Neukunde, alte Reklamation
und Sicherheitstraining berücksichtigt. Dabei ist zu beachten, dass bei mehreren Fahrern die
schlechteren Konditionen gelten. Das haben wir über die "`Alle Fahrer"'-Bedingungen abgebildet (Aussage 7). Außerdem darf nach Aussage 9 der Rabatt eine bestimmte Grenze nicht überschreiten.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\linewidth]{Bilder/Rabatt_berechnen}
	\caption{Rabatt berechnen}
	\label{fig:Rabatt_berechnen}
\end{figure}

\section{Regeln und Prozesse}
\label{sec:rules}

Aus den Aussagen und dem Flussdiagramm ergibt sich folgender grober Prozessablauf:
\begin{enumerate}
	\item Fahranfängerprüfung
	\item Ggf. Genehmigung der Fahrzeugklasse durch den Filialleiter
	\item Verfügbarkeitsprüfung
	\item Ggf. Genehmigung des Upgrades durch den Filialleiter
	\item Preisberechnung
\end{enumerate}

Die Genehmigungen sind manuelle Prozesse, die durch den Filialleiter durchgeführt werden müssen.
Die Fahranfängerprüfung, die Verfügbarkeitsprüfung sowie die Preisberechnung lassen sich über
Geschäftsregeln abbilden. 
Im Folgenden beschreiben wir die Regeln, die wir aus den Aussagen der Aufgabenstellung
extrahiert haben.

\subsection{Fahranfängerprüfung}

Regel: Definition eines Fahranfängers \\
Kategorie: Definitionsregel

\begin{lstlisting}
rule "Is driving novice" ruleflow-group "novice-check"
	when
		there is a request
		there is a customer with that request
		- age is less than 21 or has driving license for less than 2	
	then
		the customer is a driving novice	
end
\end{lstlisting}

Regel: Zuschlag für Fahranfänger \\
Kategorie: Prozessregel

\begin{lstlisting}
rule "Extra charge if at least one customer is a novice" ruleflow-group "novice-check"
	when
		there is a request
		there exists a customer who is driving novice
	then
		treat the request as novice
		set extra charge to 10%	
end
\end{lstlisting}

Regel: Genehmigung für höhere Klassen bei Fahranfängern \\
Kategorie: Prozessregel

\begin{lstlisting}
rule "Permission for higher classes required" ruleflow-group "novice-check"
	when
		there is a request
		- car class is not in ("Small", "Compact")
		there exists a customer who is driving novice
	then
		ask the boss for permission
end
\end{lstlisting}

\subsection{Verfügbarkeitsprüfung}

Regel: Downgrade aus Oberklasse, wenn nicht verfügbar \\
Kategorie: Prozessregel

\begin{lstlisting}
rule "Downgrade for upper class if not available" ruleflow-group "availibility-check"
	when
		there is a request
		- car class is "Upper"
		- car is not available
	then
		set car class to "Middle"
		set extra deduction to 10%
		update the request
end
\end{lstlisting}

Regel: Definition eines Upgrades für die Fahrzeugklasse \\
Kategorie: Definitionsregel

Es gibt eine Reihe von Regeln, die definieren welche Fahrzeugklassen ein Upgrade
für die angefragte Klasse darstellen. Folgende Regel ist ein Beispiel von
Klein- nach Kompaktwagen.

\begin{lstlisting}
rule "Upgrade from Small to Compact" ruleflow-group "availibility-check"
	when
		there is a request
		- car class is "Small"
		- "Compact" car is available
		there exists no upgrade
	then
		upgrade to "Compact" is possible	
end
\end{lstlisting}

Regel: Upgrade auf nächsthöhere Klasse, wenn nicht verfügbar \\
Kategorie: Prozessregel

\begin{lstlisting}
rule "If updgrade possible it requires permission" ruleflow-group "availibility-check"
	when
		there is a request
		- car is not available
		there is a possible upgrade
	then
		upgrade the car class
		mark the car for that request as available
end
\end{lstlisting}

\subsection{Preisberechnung}

Regel: Definition des Tagespreises \\
Kategorie: Definitionsregel

Es gibt eine Reihe von Regeln, die den Tagespreis für jede Fahrzeugklasse festlegen.
Folgende Regel ist ein Beispiel für Kleinwagen.

\begin{lstlisting}
rule "Daily price: Small class car" ruleflow-group "price-calculation"
	when
		there is a request
		- car class is "Small"
		there is a rental day from that request
	then
		set the daily price to 40.00
end
\end{lstlisting}

Regel: Wochenenden und Feiertage haben reduzierten Tagespreis \\
Kategorie: Ableitungsregel

\begin{lstlisting}
rule "Daily price: Weekend discount" ruleflow-group "price-calculation"
	when
		there is a request
		there is a rental day from that request
		- is weekend or holiday
	then
		the daily price is discounted by 25%
end
\end{lstlisting}

Regel: Jeder siebte Tag ist kostenlos \\
Kategorie: Ableitungsregel

\begin{lstlisting}
rule "Daily price: Free seventh day" ruleflow-group "price-calculation"
	when
		there is a request
		there is a rental day from that request
		- day index is in (7, 14, 21, 28)
	then
		set the daily price to 0.00
end
\end{lstlisting}

Regel: Basispreis ist die Summe der Tagespreise \\
Kategorie: Ableitungsregel

\begin{lstlisting}
rule "Base price is the sum of daily prices" ruleflow-group "price-calculation"
	when
		there is a request
		there is a rental day from that request
	then
		add the daily price to the base price
end
\end{lstlisting}

Regel: Neukundenrabatt \\
Kategorie: Ableitungsregel

\begin{lstlisting}
rule "Discount: All customers are new customers" ruleflow-group "price-calculation"
	when
		there is a request
		every customer from that request is a new customer
	then
		add 10.00 to the discount
end
\end{lstlisting}

Regel: Reklamationsrabatt \\
Kategorie: Ableitungsregel

\begin{lstlisting}
rule "Discount: All customers have an old reclamation" ruleflow-group "price-calculation"
	when
		there is a request
		every customer from that request had a valid reclamation
	then
		discount the base price by 20%
end
\end{lstlisting}

Regel: Rabatt für Sicherheitstraining \\
Kategorie: Ableitungsregel

\begin{lstlisting}
rule "Discount: All customers have participated in security training" ruleflow-group "price-calculation"
	when
		there is a request
		every customer from that request had a security training
	then
		discount the base price by 5%;
end
\end{lstlisting}

Regel: Maximaler Rabatt \\
Kategorie: Einschränkungsregel

\begin{lstlisting}
rule "Discount is limited to 100 Euro" ruleflow-group "price-calculation"
	when
		there is a request
		- discount is greater than 100.00
	then
		set the discount to 100.00
end
\end{lstlisting}

Regel: Endpreis berechnen \\
Kategorie: Ableitungsregel

\begin{lstlisting}
rule "Final Price: Calculation" ruleflow-group "price-calculation"
	when
		there is a request
	then
		set the final price to the base price
		subtract the discount from the final price
end
\end{lstlisting}

Regel: Automatikgebühr abziehen \\
Kategorie: Ableitungsregel

\begin{lstlisting}
rule "Final Price: Automatic fee" ruleflow-group "price-calculation"
	when
		there is a request
		- for an automatic car
	then
		add a 5% fee of the base price to the final price
end
\end{lstlisting}

Regel: Gesamtpreis berechnen \\
Kategorie: Ableitungsregel

\begin{lstlisting}
rule "Total Price" ruleflow-group "price-calculation"
	when
		there is a request
	then
		set percent to 100% plus extra charge minus extra deduction
		set the total price to percent% of the final price
end
\end{lstlisting}


\section{Prototyp}

Die Umsetzung des Prototypen haben wir in sechs Schritte eingeteilt:
\begin{enumerate}
	\item Festlegung des Datenmodells
	\item Schreiben von Unit-Tests
	\item Definition des Geschäftsprozesses
	\item Implementierung der Regeln in normaler Regelsprache
	\item Transformation der Regeln in eine DSL
	\item Entwurf und Implementierung einer Oberfläche
\end{enumerate}

\subsection{Datenmodell}

Die zu modellierenden Daten umfassen Kunden- und Anfragedaten. Diese beiden Datensätze
werden als Java-Klassen modelliert (Customer und RentalRequest). Zusätzlich werden die
Informationen über die zur Verfügung stehenden Autos in die Klasse Garage gespeichert.
Die einzelnen Miettage werden als RentalDay modelliert. Das Klassendiagramm in
Abbildung \ref{fig:Class_All} zeigt alle Klassen.

\begin{figure}[tbh]
\centering
\includegraphics[width=1.0\linewidth]{Bilder/Class_All}
\caption{Klassendiagramm}
\label{fig:Class_All}
\end{figure}

Die Klasse RentalRequest dient sowohl der Eingabe als auch der Ausgabe von Daten.
Das heißt, dass Regeln und Prozesse ggf. schreibend auf die aktuelle Instanz zugreifen.

\subsection{Unit-Tests: Anwendungssituation}

Nachdem wir das Datenmodell festgelegt haben, konnten wir Unit-Tests für die 
Anwendungssituationen aus der Aufgabenstellung schreiben. Dabei ist uns aufgefallen,
dass bei sequentieller Abarbeitung der Kunden A bis G die Wagen der Mittel- und
Oberklasse schnell ausgehen. Dies führt dazu dass die Anfragen der Kunden E und F
direkt abgelehnt werden. Für die Unit-Tests haben wir zusätzlich die Fälle betrachtet,
wenn es genügend Wagen in der angeforderten Klasse gibt.

Die erwarteten Preise in den einzelnen Anwendungssituationen haben wir manuell
mithilfe des initial erstellten Flussdiagramms ermittelt. Die Ergebnisse dieser
manuellen Auswertung befinden sich in Anhang \ref{sec:Anwendungssituation}.

In der Java-Klasse SituationTest werden die vorgegebenen Situationen getestet.
Zusätzlich haben wir in der Klasse ExtraTest versucht, bisher noch nicht
getestete Szenarien abzubilden. Dazu zählen z.~B. die Automatikgebühr und verschiedene
Genehmigungszenarien.

\subsection{Definition des Geschäftsprozesses}

Die Autovermietung ist ein Geschäftsprozess, in dem unterschiedliche Regelgruppen aktiviert
werden müssen. Außerdem ist ja nach Anfrage eine menschliche Interaktion durch den
Filialleiter in Form einer Genehmigung erforderlich. Dies haben wir mittels
jBPM als Prozess definiert.

Die Integration der Geschäftsregeln haben wir durch die Zuordnung zu Ruleflow-Groups
in der Regeldatei und das Einbinden von Business-Rule-Tasks in den Prozess erreicht.
Um die Genehmigung durch den Filialleiter zu ermöglichen haben wir User- bzw.
Human-Tasks eingebunden.

Der gesamte Prozess wird in Abbildung \ref{fig:Process_BPMN} dargestellt.

\begin{figure}[tbh]
\centering
\includegraphics[width=0.8\linewidth]{Bilder/Process_BPMN}
\caption{Geschäftsprozess in jBPM}
\label{fig:Process_BPMN}
\end{figure}

\subsection{Normale Regelsprache}

Um mögliche Fehlerquellen zu vermeiden, haben wir die Geschäftsregeln zuerst
in der normalen Rule-Language implementiert. Durch die ausführlichen Unit-Tests
konnten wir so Fehler schnell finden und korrigieren. Die so erstellte Regelbasis
dient als Grundlage zur Erstellung der DSL. Anhang \ref{anh:normal-rules} enthält
die entsprechende Regeldatei.

\subsection{Transformation in DSL}

Wir haben uns entschieden unsere DSL in Englisch zu implementieren, um eine Mischung
von Englisch und Deutsch zu vermeiden. Bei der Definition haben wir uns an der
einfachen Regeldatei orientiert. Nachdem alle Regeln übersetzt waren, haben wir
die Unit-Tests auf die in der DSL definierten Regeln umgestellt. Das hat uns erlaubt
Fehler bei der Transformation schnell zu finden und auch zu beheben. Die so erstellten
Regeln wurden bereits in Abschnitt \ref{sec:rules} vorgestellt.

\subsection{Oberfläche}
Zur einfachen Eingabe von Testfällen habe wir eine Java SWING GUI Programmiert. Diese besteht aus einer Haupt-Eingabemaske \ref{fig:Autovermietung} über die ein Mietgesuch eingegeben werden kann, einem Fahrer Verwaltungs-Dialog \ref{fig:kunde} und einem Garagen Konfigurations-Dialog \ref{fig:Garage}. Der Dialog zum Verwalten der Fahrer ermöglicht eingaben über den Name des Fahrers, das Alter des Fahrers, wie lange der Fahrer schon einen Führerschein besitzt, ob er ein Neukunde ist, eine Reklamation vorweisen kann und ob er ein Sicherheitstraining absolviert hat. Über den Garagen Konfigurations-Dialog kann die Anzahl der zu Verfügung stehenden Fahrzeuge in den einzelnen Fahrzeugklassen eingestellt werden. In der Haupt-Eingabemaske kann der Garagendialog aufgerufen werden und es können Fahrer über den Fahrerdialog hinzugefügt und verwaltet werden. Alle Fahrer einer Mietanfrage werden im Hauptfenster Angezeigt. Das Hauptfenster bietet die Möglichkeit zum einstellen des Mietstartdatums, der Mietdauer, der Fahrzeugklasse des Mietwagens und ob der Mietwagen eine Automatikschaltung haben soll. 

Nachdem alle Eingaben gemacht wurden kann eine Mietanfrage an das System gesendet werden. Abhängig von den Eingabewerten muss ein Fahranfänger \ref{fig:Fahränfanger} oder ein Fahrzeugupgrade \ref{fig:Upgrade} genehmigt werden. Wird eine Genehmigung nicht erteilt oder steht kein Fahrzeug mehr zur Verfügung wird die Anfrage abgelehnt \ref{fig:ergebnisabgelehnt}. Sollte die Anfrage berechnet werden, wird in einem abschließendem Dialog die Fahrzeugklasse und die zu zahlenden Kosten angezeigt \ref{fig:ergebnis}.


\begin{figure}
\centering
\includegraphics[width=0.7\linewidth]{Bilder/Screenshots/Autovermietung}
\caption{Haupt-Eingabemaske }
\label{fig:Autovermietung}
\end{figure}


\begin{figure}
\centering
\includegraphics[width=0.7\linewidth]{Bilder/Screenshots/kunde}
\caption{Kundendialog}
\label{fig:kunde}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=0.7\linewidth]{Bilder/Screenshots/Garage}
	\caption{Garagendialog}
	\label{fig:Garage}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=0.7\linewidth]{Bilder/Screenshots/Fahranfanger}
	\caption{Fahranfänger genehmigen}
	\label{fig:Fahränfanger}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=0.7\linewidth]{Bilder/Screenshots/Upgrade}
	\caption{Fahrzeugklassen Upgrade genehmigen}
	\label{fig:Upgrade}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=0.7\linewidth]{Bilder/Screenshots/ergebnis-abgelehnt}
	\caption{Anfrage abgelehnt}
	\label{fig:ergebnisabgelehnt}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=0.7\linewidth]{Bilder/Screenshots/ergebnis}
	\caption{Ergebnis einer genehmigten Anfrage}
	\label{fig:ergebnis}
\end{figure}

\section{Fazit}
Am Anfang dieses Projektes haben wir zunächst die groben Strukturen aus der Aufgabenstellung extrahiert. Dabei nutzten wir die dreizehn Aussagen, um daraus die Geschäftsregeln zu definieren. Die Regeln wurden von uns zunächst als normale Regelsprache implementiert. Der letzte Schritt bestand darin die Regelsprache in eine DSL zu überführen. Der zusätzliche Schritt über die normale Regelsprache half dabei Fehlerquellen zu vermeiden. Durch die Vorlesung und die ausführliche Onlinedokumentation gab es wenige Probleme bei der Ausführung der einzelnen Arbeitsschritte.

Es hat sich gezeigt, das die Verwendung einer DSL für ein Projekt dieser Größe eine gute alternative zur normalen Regelsprache ist. Sowohl Programmierer als auch Fachpersonal ohne Programmiererfahrung kann die DSL lesen und kleinere Änderungen machen. Das hilft gerade Personen ohne eine Affinität fürs Programmieren, da diese Fehler in der DSL finden können und entweder selbst ausbessern oder einem Programmieren darauf aufmerksam machen können. Leider sind größere Änderungen an der DSL nicht ohne Programmieraufwand zu bewerkstelligen. Eine DSL muss trotz ihrer Umgangssprache noch eine feste Struktur aufweisen.

Die Integration von Drools und jBPM in Eclipse ist sehr gut gelungen. Dadurch war es sehr einfach die Prozesse und Regeln zu implementieren. Des Weiteren war es schnell möglich, Unit-Tests zu definieren um die Regeln zu testen. Der letzte Schritt war die Integration der Prozess-Engine in die grafische Benutzeroberfläche. Auch dabei gab es keine nennenswerte Probleme.

Als endgültiges Fazit können wir sagen, dass das Arbeiten mit jBPM und Drools eine gute Erfahrung war, auch wenn einige Arbeitsschritte auf dem ersten Blick eher komplex erscheinen. Bei kleineren Projekten scheint für uns eine reine Programmierlösung einfacher. Für größere Projekte mit ausführlichen Geschäftsregeln, die in Prozesse
integriert werden müssen, kann jBPM eine akzeptable Lösung sein. 

%\appendix
\appendix

\section{Anwendungssituation}
\label{sec:Anwendungssituation}

Wir analysieren die Situation am 21. März 2016 in der Autovermietungsstation.
Dazu beschreiben wir zunächst die Ausgangssituation und dann die einzelnen Kundenanfragen.

\subsection{Ausgangssituation}

Am 21. März 2016 stehen zu jeder Fahrzeugklasse zwei Fahrzeuge zur Verfügung:

\begin{tabular}{|c|c|c|c|}
	\hline \textbf{Kleinklasse} & \textbf{Kompaktklasse} & \textbf{Mittelklasse} & \textbf{Oberklasse}  \\ 
	\hline 2 & 2 & 2 & 2 \\ 
	\hline 
\end{tabular} 

Relevante Feiertage:
\begin{itemize}
	\item Fr 25.03.2016: Karfreitag
	\item Mo 28.03.2016: Ostermontag
	\item So 01.05.2016: 1. Mai / Tag der Arbeit
\end{itemize}

Vorgehen:
\begin{itemize}
	\item Wir runden mathematisch, weil das einfacher zu implementieren ist.
	\item Nicht spezifizierte Anfrageparameter nehmen einen Standardwert an (Nein, bzw. 0).
	\item Bei nicht angegebenem Alter ist der Kunde älter als 21 Jahre.
	\item Der Filialleiter genehmigt alle Anfragen.
	\item Wenn die Anfrage abgelehnt wird, weil keine Wagen der angefragten Klasse vorhanden sind,
	wird als Alternative dieselbe Anfrage mit vorhandener Klasse betrachtet.
\end{itemize}

\subsection{Kunde A}

Kundendaten:\\
\begin{tabular}{|c|c|c|c|c|}
	\hline \textbf{Alter} & \textbf{Führerschein} & \textbf{Neukunde} & \textbf{Reklamation} & \textbf{Sicherheitstraining} \\ 
	\hline 42 & 20 & Nein & Nein & Ja \\ 
	\hline 
\end{tabular} 
\\\\
Anfrage:\\
\begin{tabular}{|c|c|c|}
	\hline \textbf{Klasse} & \textbf{Dauer in Tagen} & \textbf{Automatik} \\ 
	\hline Mittel & 5 & Nein \\ 
	\hline 
\end{tabular}

\vspace{12pt}
Preisberechnung:
\begin{itemize}
	\item Zeitraum: 4 Wochentage, 0 Wochenende, 1 Feiertag
	\item Fahranfängerprüfung: Bestanden, Zuschlag: 0\%
	\item Verfügbarkeitsprüfung: Bestanden, Nachlass: 0\%
	\item Tagespreis: 70€/Wochentag, 52,50€/Feiertag
	\item Basispreis = 70€ * 4 + 52,50€ * 1 = 332,50€
	\item Rabatt = 5\% * Basispreis = 16,63€
	\item Endpreis = 315,87€
	\item Gesamtpreis = Endpreis = 315,87€
\end{itemize}

Zustand nach Vermietung:\\
\begin{tabular}{|c|c|c|c|}
	\hline \textbf{Kleinklasse} & \textbf{Kompaktklasse} & \textbf{Mittelklasse} & \textbf{Oberklasse}  \\ 
	\hline 2 & 2 & 1 & 2 \\ 
	\hline 
\end{tabular} 

\subsection{Kunde B}

Kundendaten:\\
\begin{tabular}{|c|c|c|c|c|}
	\hline \textbf{Alter} & \textbf{Führerschein} & \textbf{Neukunde} & \textbf{Reklamation} & \textbf{Sicherheitstraining} \\ 
	\hline 20 & 3 & Ja & Nein & Nein \\ 
	\hline 
\end{tabular} 
\\\\
Anfrage:\\
\begin{tabular}{|c|c|c|}
	\hline \textbf{Klasse} & \textbf{Dauer in Tagen} & \textbf{Automatik} \\ 
	\hline Mittel & 1 & Nein \\ 
	\hline 
\end{tabular}

Preisberechnung:
\begin{itemize}
	\item Zeitraum: 1 Wochentag, 0 Wochenende oder Feiertage
	\item Fahranfängerprüfung: Genehmigung, Bestanden, Zuschlag: 10\%
	\item Verfügbarkeitsprüfung: Bestanden, Nachlass: 0\%
	\item Tagespreis: 70€/Wochentag, 52,50€/Feiertag
	\item Basispreis = 70€ * 1 + 52,50€ * 0 = 70,00€
	\item Rabatt = 10,00€
	\item Endpreis = 60,00€
	\item Gesamtpreis = 110\% * Endpreis = 66,00€
\end{itemize}

Zustand nach Vermietung:\\
\begin{tabular}{|c|c|c|c|}
	\hline \textbf{Kleinklasse} & \textbf{Kompaktklasse} & \textbf{Mittelklasse} & \textbf{Oberklasse}  \\ 
	\hline 2 & 2 & 0 & 2 \\ 
	\hline 
\end{tabular} 

\subsection{Kunde C}

Kundendaten:\\
\begin{tabular}{|c|c|c|c|c|}
	\hline \textbf{Alter} & \textbf{Führerschein} & \textbf{Neukunde} & \textbf{Reklamation} & \textbf{Sicherheitstraining} \\ 
	\hline 30 & 12 & Nein & Nein & Nein \\ 
	\hline 
\end{tabular} 
\\\\
Anfrage:\\
\begin{tabular}{|c|c|c|}
	\hline \textbf{Klasse} & \textbf{Dauer in Tagen} & \textbf{Automatik} \\ 
	\hline Mittel & 7 & Nein \\ 
	\hline 
\end{tabular}

Zwischenergebnis:
\begin{itemize}
	\item Zeitraum: 4 Wochentag, 2 Wochenende oder Feiertage, 1 Gratistag
	\item Fahranfängerprüfung: Bestanden, Zuschlag: 0\%
	\item Verfügbarkeitsprüfung: Genehmigung, Bestanden, Upgrade auf höhere Klasse, Nachlass: 0\%
	\item Tagespreis: 70€/Wochentag, 52,50€/Feiertag
	\item Basispreis = 70€ * 4 + 52,50€ * 2 + 0€ * 1 = 385,00€
	\item Rabatt = 0,00€
	\item Endpreis = 385,00€
	\item Gesamtpreis = 100\% * Endpreis = 385,00€
\end{itemize}

Zustand nach Vermietung:\\
\begin{tabular}{|c|c|c|c|}
	\hline \textbf{Kleinklasse} & \textbf{Kompaktklasse} & \textbf{Mittelklasse} & \textbf{Oberklasse}  \\ 
	\hline 2 & 2 & 0 & 1 \\ 
	\hline 
\end{tabular} 

\subsection{Kunde D}

Kundendaten:\\
\begin{tabular}{|c|c|c|c|c|}
	\hline \textbf{Alter} & \textbf{Führerschein} & \textbf{Neukunde} & \textbf{Reklamation} & \textbf{Sicherheitstraining} \\ 
	\hline 35 & 10 & Ja & Nein & Nein \\ 
	\hline 
\end{tabular} 
\\\\
Anfrage:\\
\begin{tabular}{|c|c|c|}
	\hline \textbf{Klasse} & \textbf{Dauer in Tagen} & \textbf{Automatik} \\ 
	\hline Mittel & 1 & Nein \\ 
	\hline 
\end{tabular}

Preisberechnung:
\begin{itemize}
	\item Zeitraum: 1 Wochentag, 0 Wochenende oder Feiertage
	\item Fahranfängerprüfung: Bestanden, Zuschlag: 0\%
	\item Verfügbarkeitsprüfung: Genehmigung, Bestanden, Upgrade auf höhere Klasse, Nachlass: 0\%
	\item Tagespreis: 70€/Wochentag, 52,50€/Feiertag
	\item Basispreis = 70€ * 1 + 52,50€ * 0 = 70,00€
	\item Rabatt = 10,00€
	\item Endpreis = 60,00€
	\item Gesamtpreis = 100\% * Endpreis = 60,00€
\end{itemize}

Zustand nach Vermietung:\\
\begin{tabular}{|c|c|c|c|}
	\hline \textbf{Kleinklasse} & \textbf{Kompaktklasse} & \textbf{Mittelklasse} & \textbf{Oberklasse}  \\ 
	\hline 2 & 2 & 0 & 0 \\ 
	\hline 
\end{tabular}

\subsection{Kunde E (abgelehnt)}

Kundendaten:\\
\begin{tabular}{|c|c|c|c|c|}
	\hline \textbf{Alter} & \textbf{Führerschein} & \textbf{Neukunde} & \textbf{Reklamation} & \textbf{Sicherheitstraining} \\ 
	\hline 46 & 20 & Ja & Nein & Nein \\ 
	\hline 
\end{tabular} 
\\\\
Anfrage:\\
\begin{tabular}{|c|c|c|}
	\hline \textbf{Klasse} & \textbf{Dauer in Tagen} & \textbf{Automatik} \\ 
	\hline Ober & 6 & Nein \\ 
	\hline 
\end{tabular}

Preisberechnung:
\begin{itemize}
	\item Zeitraum: 4 Wochentag, 2 Wochenende oder Feiertage
	\item Fahranfängerprüfung: Bestanden, Zuschlag: 0\%
	\item Verfügbarkeitsprüfung: Genehmigung, Abgelehnt, Nachlass: 10\%, Klasse = Mittel
	
	% Es gibt noch eine Oberklasse:
	%\item Tagespreis: 90€/Wochentag, 67,50€/Feiertag
	%\item Basispreis = $90€ * 4 + 67,50€ * 2 = 495,00€$
	%	\item Rabatt = 10,00€
	%	\item Endpreis = 485,00€
	%	\item Gesamtpreis = 100\% * Endpreis = 485,00€
	
	% Es gibt keine Oberklasse aber eine Mittelklasse
	%	\item Tagespreis: 70€/Wochentag, 52,50€/Feiertag
	%	\item Basispreis = $70€ * 4 + 52,50€ * 2 = 385,00€$
	%	\item Rabatt = 10,00€
	%	\item Endpreis = 375,00€
	%	\item Gesamtpreis = 90\% * Endpreis = 337,50€
\end{itemize}

Abgelehnt: Keine Änderung
Zustand nach Vermietung:\\
\begin{tabular}{|c|c|c|c|}
	\hline \textbf{Kleinklasse} & \textbf{Kompaktklasse} & \textbf{Mittelklasse} & \textbf{Oberklasse}  \\ 
	\hline 2 & 2 & 0 & 0 \\ 
	\hline 
\end{tabular}

\subsection{Kunde F (abgelehnt)}

Kundendaten:\\
\begin{tabular}{|c|c|c|c|c|}
	\hline \textbf{Alter} & \textbf{Führerschein} & \textbf{Neukunde} & \textbf{Reklamation} & \textbf{Sicherheitstraining} \\ 
	\hline 32 & 10 & Nein & Nein & Ja \\ 
	\hline 
\end{tabular} 
\\\\
Anfrage:\\
\begin{tabular}{|c|c|c|}
	\hline \textbf{Klasse} & \textbf{Dauer in Tagen} & \textbf{Automatik} \\ 
	\hline Ober & 4 & Nein \\ 
	\hline 
\end{tabular}

Zwischenergebnis:
\begin{itemize}
	\item Zeitraum: 4 Wochentag, 0 Wochenende oder Feiertage
	\item Fahranfängerprüfung: Bestanden, Zuschlag: 0\%
	\item Verfügbarkeitsprüfung: Genehmigung, Abgelehnt, Nachlass: 0\%
	%	\item Tagespreis: 90€/Wochentag, 67,50€/Feiertag
	%	\item Basispreis = $90€ * 4 + 67,50€ * 0 = 360,00€$
	%	\item Rabatt = 20\% * 360€ + 5\% * 360€ = 72€ + 18€ = 90€
	%	\item Endpreis = 270,00€
	%	\item Gesamtpreis = 100\% * Endpreis = 270,00€
	
	% Siehe E
\end{itemize}

Abgelehnt: Keine Änderung
Zustand nach Vermietung:\\
\begin{tabular}{|c|c|c|c|}
	\hline \textbf{Kleinklasse} & \textbf{Kompaktklasse} & \textbf{Mittelklasse} & \textbf{Oberklasse}  \\ 
	\hline 2 & 2 & 0 & 0 \\ 
	\hline 
\end{tabular}

\subsection{Kunde G}

Kundendaten:\\
\begin{tabular}{|c|c|c|c|c|}
	\hline \textbf{Alter} & \textbf{Führerschein} & \textbf{Neukunde} & \textbf{Reklamation} & \textbf{Sicherheitstraining} \\ 
	\hline 30 & 6 & Nein & Nein & Ja \\ 
	\hline 25 & 1 & Nein & Nein & Nein \\ 
	\hline 
\end{tabular} 
\\\\
Anfrage:\\
\begin{tabular}{|c|c|c|}
	\hline \textbf{Klasse} & \textbf{Dauer in Tagen} & \textbf{Automatik} \\ 
	\hline Kompakt & 1 & Nein \\ 
	\hline 
\end{tabular}

Zwischenergebnis:
\begin{itemize}
	\item Zeitraum: 1 Wochentag, 0 Wochenende oder Feiertage
	\item Fahranfängerprüfung: Bestanden, Zuschlag: 10\%
	\item Verfügbarkeitsprüfung: Bestanden, Nachlass: 0\%
	\item Tagespreis: 50€/Wochentag, 37,50€/Feiertag
	\item Basispreis = 50€ * 1 + 37,50€ * 0 = 50,00€
	\item Rabatt = 0€
	\item Endpreis = 50,00€
	\item Gesamtpreis = 110\% * Endpreis = 55,00€
\end{itemize}

Zustand nach Vermietung:\\
\begin{tabular}{|c|c|c|c|}
	\hline \textbf{Kleinklasse} & \textbf{Kompaktklasse} & \textbf{Mittelklasse} & \textbf{Oberklasse}  \\ 
	\hline 2 & 2 & 0 & 0 \\ 
	\hline 
\end{tabular}

\subsection{Kunde E (angenommen)}

Wir nehmen an, es gäbe ausreichend Wagen jeder Klasse:

\begin{tabular}{|c|c|c|c|}
	\hline \textbf{Kleinklasse} & \textbf{Kompaktklasse} & \textbf{Mittelklasse} & \textbf{Oberklasse}  \\ 
	\hline 2 & 2 & 2 & 2 \\ 
	\hline 
\end{tabular}

Kundendaten:\\
\begin{tabular}{|c|c|c|c|c|}
	\hline \textbf{Alter} & \textbf{Führerschein} & \textbf{Neukunde} & \textbf{Reklamation} & \textbf{Sicherheitstraining} \\ 
	\hline 46 & 20 & Ja & Nein & Nein \\ 
	\hline 
\end{tabular} 
\\\\
Anfrage:\\
\begin{tabular}{|c|c|c|}
	\hline \textbf{Klasse} & \textbf{Dauer in Tagen} & \textbf{Automatik} \\ 
	\hline Ober & 6 & Nein \\ 
	\hline 
\end{tabular}

Preisberechnung:
\begin{itemize}
	\item Zeitraum: 4 Wochentag, 2 Wochenende oder Feiertage
	\item Fahranfängerprüfung: Bestanden, Zuschlag: 0\%
	\item Verfügbarkeitsprüfung: Bestanden, Nachlass: 0\%
	
	% Es gibt noch eine Oberklasse:
	\item Tagespreis: 90€/Wochentag, 67,50€/Feiertag
	\item Basispreis = $90€ * 4 + 67,50€ * 2 = 495,00€$
	\item Rabatt = 10,00€
	\item Endpreis = 485,00€
	\item Gesamtpreis = 100\% * Endpreis = 485,00€
	
	% Es gibt keine Oberklasse aber eine Mittelklasse
	%	\item Tagespreis: 70€/Wochentag, 52,50€/Feiertag
	%	\item Basispreis = $70€ * 4 + 52,50€ * 2 = 385,00€$
	%	\item Rabatt = 10,00€
	%	\item Endpreis = 375,00€
	%	\item Gesamtpreis = 90\% * Endpreis = 337,50€
\end{itemize}

Zustand nach Vermietung:\\
\begin{tabular}{|c|c|c|c|}
	\hline \textbf{Kleinklasse} & \textbf{Kompaktklasse} & \textbf{Mittelklasse} & \textbf{Oberklasse}  \\ 
	\hline 2 & 2 & 2 & 1 \\ 
	\hline 
\end{tabular}

\subsection{Kunde F (angenommen)}

Wir nehmen an, es gäbe ausreichend Wagen jeder Klasse:

\begin{tabular}{|c|c|c|c|}
	\hline \textbf{Kleinklasse} & \textbf{Kompaktklasse} & \textbf{Mittelklasse} & \textbf{Oberklasse}  \\ 
	\hline 2 & 2 & 2 & 2 \\ 
	\hline 
\end{tabular}

Kundendaten:\\
\begin{tabular}{|c|c|c|c|c|}
	\hline \textbf{Alter} & \textbf{Führerschein} & \textbf{Neukunde} & \textbf{Reklamation} & \textbf{Sicherheitstraining} \\ 
	\hline 32 & 10 & Nein & Nein & Ja \\ 
	\hline 
\end{tabular} 
\\\\
Anfrage:\\
\begin{tabular}{|c|c|c|}
	\hline \textbf{Klasse} & \textbf{Dauer in Tagen} & \textbf{Automatik} \\ 
	\hline Ober & 4 & Nein \\ 
	\hline 
\end{tabular}

Zwischenergebnis:
\begin{itemize}
	\item Zeitraum: 4 Wochentag, 0 Wochenende oder Feiertage
	\item Fahranfängerprüfung: Bestanden, Zuschlag: 0\%
	\item Verfügbarkeitsprüfung: Bestanden, Nachlass: 0\%
	\item Tagespreis: 90€/Wochentag, 67,50€/Feiertag
	\item Basispreis = 90€ * 4 + 67,50€ * 0 = 360,00€
	\item Rabatt = 20\% * 360€ + 5\% * 360€ = 72€ + 18€ = 90€
	\item Endpreis = 270,00€
	\item Gesamtpreis = 100\% * Endpreis = 270,00€
	
	% Siehe E
\end{itemize}

Abgelehnt: Keine Änderung
Zustand nach Vermietung:\\
\begin{tabular}{|c|c|c|c|}
	\hline \textbf{Kleinklasse} & \textbf{Kompaktklasse} & \textbf{Mittelklasse} & \textbf{Oberklasse}  \\ 
	\hline 2 & 2 & 2 & 1 \\ 
	\hline 
\end{tabular}

\section{Normale Rule-Language}
\label{anh:normal-rules}

\lstinputlisting{src/rental-rules.drl}

%\newpage
%\printbibliography

\end{document}